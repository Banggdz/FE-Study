fetch("/api/benhnhan/moi", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
})
.then(res => {
    if (res.ok) return res.json();
    else throw new Error('Lỗi server');
})
.then(json => {
    alert('Thêm bệnh nhân thành công: ' + json.hoTen);
    form.reset();
})
.catch(err => alert(err));

1️⃣ fetch() trả về Promise.
.then(res => {...}) là first handler:
Nếu res.ok (HTTP status 2xx) → parse JSON, Promise tiếp theo nhận dữ liệu json.
Nếu không res.ok → throw new Error('Lỗi server') → bị bắt bởi .catch().

2️⃣.then(json => {...}) là second handler, nhận dữ liệu JSON từ res.json().

.catch(err => alert(err)) là catch tất cả lỗi trong chain:

Nếu fetch() bị lỗi mạng (network error, server down…).

Hoặc nếu bạn throw trong .then() (như throw new Error('Lỗi server')).

3️⃣ err là gì?

err là Error object mà bạn throw hoặc fetch ném ra.

Ví dụ:
throw new Error('Lỗi server');
→ .catch(err) nhận object Error:

console.log(err);        // Error: Lỗi server
console.log(err.message); // "Lỗi server"

Nếu fetch gặp network error, err cũng là TypeError object.

--------

<body>
    <div id="category">
    </div>
    <!-- <script src="promise.js"></script> -->
    <script src="fetch.js"></script>
</body>

--FETCH.JS--
fetch(`https://dummyjson.com/products`)

.then(response=>response.json())
.then(data=>{
    console.log(data);
    let htmls="";
    data.products.forEach(item => {
        htmls+=`<div class="category-item">${item.title}</div>`;
    });
    console.log(htmls);
    const divCategory=document.querySelector("#category");
    divCategory.innerHTML=htmls;
})
// fetch('https://dummyjson.com/comments')
// .then(res => res.json())
// .then(console.log);
.catch(error => {
    console.error("Lỗi:", error);
});

// GET CATEGORY 
fetch(`https://dummyjson.com/products/categories`)

.then(response=>response.json())
.then(data=>{
    console.log(data);
    let htmls="";
    data.forEach(item => {
        htmls+=`<div class="category-item">${item.name}</div>`;
    });
    console.log(htmls);
    const divCategory=document.querySelector("#category");
    divCategory.innerHTML=htmls;
    
})
.catch((error)=>{
    console.log(error);
});

----
//GET PRODUCT
fetch("https://dummyjson.com/products")
.then(response=>response.json())
.then(data=>{
    let htmls="";
    console.log(data);
    data.products.forEach(item=>{
        htmls+=`<div class="product-item">
            <img src="${item.thumbnail}"alt="${item.title}f">
            <h3>${item.title}</h3>
            <p>${item.price}</p>
        </div>`
    });
   const divProducts=document.querySelector("#products");
   divProducts.innerHTML=htmls;
})
--Viet ham rieng---
const fetchAPi=(url)=>{
    const result=fetch(url)
    .then(response=>response.json())
    .then(data=>{
        return data;
    });
    return result;
}
fetchAPi("https://dummyjson.com/products/categories")
.then(data=>{
    let htmls="";
    data.forEach(item => {
        htmls+=`<div class="category-item">${item.name}</div>`;
    });
    const divCategory=document.querySelector("#category");
    divCategory.innerHTML=htmls;
    
})
---Async Await---

const fetchApiAsyncAwait = async()=>{
    const response=await fetch("https://dummyjson.com/products/categories");
    const result=await response.json();
    // console.log(response);

    // neu ko co await se ra pending
    // console.log(result);
    return result;
}

const test=fetchApiAsyncAwait();
console.log(test);

fetchApiAsyncAwait("https://dummyjson.com/products")
.then(data=>{
    let htmls="";
    data.products.forEach(item=>{
        htmls+=`<div class="product-item">
            <img src="${item.thumbnail}"alt="${item.title}f">
            <h3>${item.title}</h3>
            <p>${item.price}</p>
        </div>`
    });
   const divProducts=document.querySelector("#products");
   divProducts.innerHTML=htmls;
})
